import { processHtmlAttributes } from "../../common/html-attributes"
import IconButton from '<ebay-icon-button>'
import Button from '<ebay-button>'

static var ignoredAttributes = [
    "class",
    "style",
    "type",
    "text",
    "icon",
    "a11yText",
    "noToggleIcon",
    "expanded",
    "reverse",
    "fixWidth",
    "borderless",
    "size",
    "priority",
    "iconTag",
    "disabled",
    "variant",
    "items",
    "label",
    "textAlign",
    "transparent"
];

$ {
    var isOverflowVariant = input.variant === "overflow";
    var isFormVariant = input.variant === "form";
    var isButtonVariant = true;
    if (input.borderless) {
        isOverflowVariant = false;
    }
    var priority: string | null = null;
    var prefix = 'expand-btn'
    var variant: string | undefined;
    var isIconVariant = input.variant === 'icon' || isOverflowVariant;

    var tagName: Marko.Template = Button;
    if (isFormVariant) {
        prefix = 'btn';
        variant = 'form';
    } else if (isIconVariant) {
        tagName = IconButton;
        isButtonVariant = false;
    } else {
        priority = input.priority ?? null;
        prefix = 'btn';
    }
}
<span
    ...processHtmlAttributes(input, ignoredAttributes)
    class=["fake-menu-button", input.class]
    style=input.style
    on-expander-expand("handleExpand")
    on-expander-collapse("handleCollapse")
    onMousedown("handleMousedown")>
    <${tagName}
        class=[
            `fake-menu-button__button`
        ]
        size=input.size
        borderless=input.borderless
        priority=priority
        variant=variant
        transparent=(isIconVariant && input.transparent)
        iconOnly=(!input.text && !input.icon && !isOverflowVariant)
        ariaExpanded="false"
        ariaLabel=input.a11yText
        disabled=input.disabled
        noToggle-icon=input.noToggleIcon
        on-escape("handleButtonEscape")
        key="button">
        <if(isOverflowVariant)>
            <ebay-overflow-vertical-24-icon/>
        </if>
        <else>
            <span class=[
                `${prefix}__cell`,
                input.label && "menu-button__control--custom-label",
                input.textAlign === "center" && "expand-btn__cell--center"
            ]>
                <if(input.label)>
                    <${input.label.renderBody}/>
                </if>
                <else>
                    <if(input.icon)>
                        <${input.icon}/>
                    </if>
                    <if(input.text)>
                        <span>${input.text}</span>
                    </if>
                </else>
                <if(isButtonVariant && !input.noToggleIcon)>
                    <ebay-chevron-down-12-icon/>
                </if>
            </span>
        </else>
    </>
    <ebay-fake-menu
        classPrefix="fake-menu-button"
        type=input.type
        reverse=(isOverflowVariant ? !input.reverse : input.reverse)
        fixWidth=input.fixWidth
        tabindex=-1
        on-keydown("handleMenuKeydown")
        on-select("handleMenuSelect")
        key="content">
        <for|item| of=(input.items || [])>
            <@item ...item/>
        </for>
    </ebay-fake-menu>
</span>
