import{t as H,r as K,b as $,d as C,p as v,e as u,c as O}from"./registry-BVpmXZbM.js";import{_}from"./dynamic-tag-CptWGHl0.js";import{_ as V}from"./index-BYXJZKRQ.js";import{_ as N}from"./render-tag-mtfFSHEK.js";import{_ as I}from"./of-fallback-C2gEBeKK.js";import{s as w,c as R}from"./index-BGXtVBud.js";import{s as U}from"./index-D52eSIAE.js";import{h as G,a as P}from"./index-blmbJU0z.js";const Y=1300;class j extends Marko.Component{get isAutoSelection(){return this.input.listSelection==="auto"}elementScroll(){w(this.getEls("option")[this.state.selectedIndex])}handleChange(e,s){var t;if(this.state.selectedIndex!==e){const a=(t=this.input.options)==null?void 0:t[e];if(a.disabled)return;this.state.selectedIndex=e,this.once("update",()=>{this.emit("change",{index:e,wasClicked:s,selected:[a.value],el:this.getEls("option")[e]})})}}handleClick(e){this.handleChange(e,!0)}handleMouseDown(){this.wasClicked=!0}handleKeyDown(e){G(e,()=>{this.emit("escape")}),P(e,()=>this.handleChange(this._activeDescendant.index,!1));const s=this.getTypeaheadIndex(this.getEl("options").children,e.key,this.input.typeaheadTimeoutLength||Y);if(s!==-1){this._activeDescendant.index=s;const t=this.getEl("options");t.scrollTop=this.getEls("option")[s].offsetTop-t.offsetHeight/2}}handleListboxChange(e){const s=parseInt(e.detail.toIndex,10),t=this.getEls("option")[s],a=this.wasClicked;w(t),this.wasClicked&&(this.wasClicked=!1),this.handleChange(s,a)}onCreate(){this.state={selectedIndex:-1}}onInput(e){const{state:s}=this;e.options=e.options||[],s.selectedIndex=Math.max(-1,e.options.findIndex(t=>t.selected))}onMount(){this._setupMakeup()}onUpdate(){this._setupMakeup()}onRender(){typeof window<"u"&&this._cleanupMakeup()}onDestroy(){this._cleanupMakeup()}_setupMakeup(){const{input:e,state:s}=this;if(e.options.length&&!e.disabled){const t=this.getEl("options"),a=this.getEl("options");this._activeDescendant=R(t,a,a,".listbox__option[role=option]",{activeDescendantClassName:"listbox__option--active",autoInit:s.selectedIndex,autoReset:null,autoScroll:!this.isAutoSelection});const{getIndex:b,destroy:d}=U();this.getTypeaheadIndex=b,this.destroyTypeahead=d}}_cleanupMakeup(){this._activeDescendant&&(this._activeDescendant.reset(),this._activeDescendant.destroy(),this._activeDescendant=void 0)}}const x="EvVdpTum",l=H(x),ae=l;K.r(x,()=>l);const T=j;l._=$(function(f,e,s,t,a,b){const{name:d,class:E,disabled:q,options:c,tabindex:M=0,typeaheadTimeoutLength:z,...S}=f;var k=c[a.selectedIndex];e.be("div",C(v(S),{role:"listbox",class:u(["listbox__options",E]),tabindex:M}),"@options",t,null,4,{pa:{tabindex:1},onactiveDescendantChange:s.d("activeDescendantChange",t.isAutoSelection?"handleListboxChange":void 0,!1),onkeydown:s.d("keydown",!t.isAutoSelection&&"handleKeyDown",!1)});{let h=0;for(const i of I(c||[])){let r=h++;const{value:B,class:A,text:p,selected:F,disabled:m,tabindex:D,icon:g,description:o,...L}=i,y="@option[]",n=`[${y}]`;e.be("div",C(v(L),{class:u(["listbox__option",A]),role:"option",tabindex:m?-1:D,"aria-disabled":m&&"true","aria-selected":k===i&&"true"}),y,t,null,4,{pa:{class:1},onclick:s.d("click",!t.isAutoSelection&&"handleClick",!1,[r]),onmousedown:s.d("mousedown",t.isAutoSelection&&"handleMouseDown",!1)}),g?(e.be("span",{class:"listbox__value"},"0"+n,t,null,1),_(e,g,null,null,null,null,s,"1"+n),p&&(e.be("span",null,"2"+n,t,null,0),e.t(p,t),e.ee()),o&&(e.be("span",null,"3"+n,t,null,0),_(e,o,null,null,null,null,s,"4"+n),e.ee()),e.ee()):(e.be("span",{class:"listbox__value"},"5"+n,t,null,1),e.t(p,t),e.ee(),o&&(e.be("span",{class:"listbox__description"},"6"+n,t,null,1),_(e,o,null,null,null,null,s,"7"+n),e.ee())),N(V,{},e,s,"8"+n),e.ee()}}e.ee(),e.be("select",{hidden:"",class:"listbox__native",name:d},"9",t,null,0);{let h=0;for(const i of I(c||[])){const r=`[${h++}]`;e.e("option",{value:i.value,selected:i===k,class:u(i.class)},"10"+r,t,0,0)}}e.ee()},{t:x},T);l.Component=O(T,l._);export{ae as C};
