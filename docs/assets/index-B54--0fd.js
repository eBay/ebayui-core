import{t as D,r as K,b as T,e as a,f as R,d as c,p as h,c as U}from"./registry-CyswyZw5.js";/* empty css                    */import{s as N}from"./index-htxwKVWG.js";import{_ as q}from"./dynamic-tag-CXXozR29.js";import{_ as z}from"./index-Dvv9KJ1o.js";import{_ as k}from"./render-tag-CLyPs9qZ.js";import{_ as H}from"./index-DcOOfxWY.js";import{_ as X}from"./of-fallback-C2gEBeKK.js";import{s as j,c as G}from"./index-BGXtVBud.js";import{s as J}from"./index-DbKxOVwg.js";import{c as P,d as Q,h as W,e as Y}from"./index-CbT4wDAv.js";function Z(l=""){return new RegExp(l.trim().replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i")}class ee extends Marko.Component{focus(){this.getEl("combobox").focus()}handleFocus(){this._emitComboboxEvent("focus")}isExpanded(){return this.expander&&this.expander.expanded}isCollapsed(){return this.expander&&!this.expander.expanded}expand(){this.isCollapsed()&&(this.expander.expanded=!0)}collapse(){this.isExpanded()&&(this.expander.expanded=!1)}handleButtonClick(e){this.buttonClicked=!0,this.emit("button-click",{originalEvent:e})}handleActiveDescendantChange(e){if(this.listSelection==="automatic"){const t=this._getVisibleOptions()[e.detail.toIndex];this.getEl("combobox").value=t.text}}setSelectedView(){const e=this._getVisibleOptions().indexOf(this._getSelectedOption());this.activeDescendant.index=e;const t=this.getEls("options")[e];t&&j(t)}handleExpand(){this.state.viewAllOptions?this.setSelectedView():(this.state.viewAllOptions=!0,this.once("update",()=>{this.setSelectedView()})),this.emit("expand")}handleCollapse(){this.activeDescendant.reset(),this.emit("collapse")}handleComboboxClick(e){e.target===document.activeElement&&this.expand()}handleComboboxKeyDown(e){P(e,()=>{e.preventDefault(),this.expand()}),Q(e,()=>{if(this.isExpanded()){const t=this.activeDescendant.index;t!==-1&&this._setSelectedText(this._getVisibleOptions()[t].text),this.input.expanded!==!0&&this.collapse()}}),W(e,()=>{this.collapse()}),this.emit("keydown",e)}handleComboboxKeyUp(e){Y(e,()=>{this.state.currentValue=this.getEl("combobox").value,this.once("update",()=>{this.expand()}),this.state.viewAllOptions=!1,this._emitComboboxEvent("input-change")})}handleComboboxBlur(){const e=this.optionClicked;e&&this.focus(),!e&&!this.buttonClicked&&this.input.expanded!==!0&&this.collapse(),this.buttonClicked=!1;const t=this.getEl("combobox");this.listSelection==="automatic"&&t.value!==this.state.currentValue&&(this.state.currentValue=t.value),this.lastValue!==this.state.currentValue&&(this.lastValue=this.state.currentValue,this._emitComboboxEvent("change"))}handleSelectOption(e){this._setSelectedText(e),this.emit("option-click",e)}handleFloatingLabelInit(){this._emitComboboxEvent("floating-label-init")}onInput(e){this.autocomplete=e.autocomplete==="list"?"list":"none",this.listSelection=e.listSelection==="manual"?"manual":"automatic",this.lastValue=e.value,this.state={currentValue:this.lastValue,viewAllOptions:this.state&&this.state.viewAllOptions||!0},this.expander&&(this.expandedChange=e.expanded!==this.expanded,this.expandedChange&&(this.expander.expanded=e.expanded)),this.expanded=e.expanded}onMount(){this._setupMakeup()}onUpdate(){this._setupMakeup()}onRender(){typeof window<"u"&&this._cleanupMakeup()}onDestroy(){this._cleanupMakeup()}_setupFloatingLabel(){this._floatingLabel?(this._floatingLabel.refresh(),this.handleFloatingLabelInit()):document.readyState==="complete"?this.el&&(this._floatingLabel=new N(this.el),this.handleFloatingLabelInit()):this.subscribeTo(window).once("load",()=>{this._setupFloatingLabel()})}_setupMakeup(){this._hasVisibleOptions()&&(this.activeDescendant||(this.activeDescendant=G(this.el,this.getEl("combobox"),this.getEl("listbox"),'[role="option"]',{activeDescendantClassName:"combobox__option--active",autoInit:-1,autoReset:-1,axis:"y",autoScroll:!0})),this.expander||(this.expander=new J(this.el,{autoCollapse:!this.expanded,expandOnFocus:!0,collapseOnFocusOut:!this.expanded&&!this.input.button,contentSelector:'[role="listbox"]',hostSelector:'[role="combobox"]',expandedClass:"combobox--expanded",simulateSpacebarClick:!0})),this.expandedChange&&(this.expander.expanded=this.expanded,this.expandedChange=!1)),this.input.floatingLabel&&this._setupFloatingLabel()}_cleanupMakeup(){this.activeDescendant&&(this.activeDescendant.reset(),this.activeDescendant.destroy(),this.activeDescendant=null),this.expander&&(this.expander.destroy(),this.expander=null),this._floatingLabel&&(this._floatingLabel.destroy(),this._floatingLabel=null)}_setSelectedText(e){if(this.state.currentValue!==e){const t=this.getEl("combobox");this.state.currentValue=t.value=e,t.selectionStart=t.selectionEnd=e.length,t.focus(),this._emitComboboxEvent("select")}}_getSelectedOption(){return[...this.input.options??[]].find(e=>e.text===this.state.currentValue)}_getVisibleOptions(){var t;if(this.autocomplete==="none"||this.state.viewAllOptions)return[...this.input.options??[]];const e=Z((t=this.state.currentValue)==null?void 0:t.toString());return[...this.input.options??[]].filter(s=>e.test(s.text||"")||s.sticky)}_hasVisibleOptions(){return!this.input.disabled&&this._getVisibleOptions().length>0}_emitComboboxEvent(e){this.emit(`${e}`,{currentInputValue:this.state.currentValue,selectedOption:this._getSelectedOption(),options:this.input.options})}}const r="qXvwbDvk",o=D(r);K.r(r,()=>o);const C=ee;o._=T(function(l,e,t,s,p,te){const{class:v,id:V,button:u,disabled:b,style:y,borderless:w,autocomplete:se,options:ie,floatingLabel:d,listSelection:ae,expanded:le,fluid:x,chevronSize:O,...S}=l,{class:E,renderBody:f,...L}=u||{};var m=!!u,I=x?"div":"span",_=V||s.getElId("input");e.be(I,{class:a(["combobox",d&&"floating-label",x&&"combobox--fluid",v]),style:R(y)},"0",s,null,1,{onactiveDescendantChange:t.d("activeDescendantChange","handleActiveDescendantChange",!1),"onexpander-expand":t.d("expander-expand","handleExpand",!1),"onexpander-collapse":t.d("expander-collapse","handleCollapse",!1)}),d&&(e.be("label",{for:_,class:a(["floating-label__label",b&&"floating-label__label--disabled"])},"1",s,null,0),e.t(d,s),e.ee()),e.be("span",{class:a(["combobox__control",m&&"combobox__control--actionable",w&&"combobox__control--borderless"])},"2",s,null,1);{e.e("input",c(h(S),{id:_,type:"text",role:"combobox",disabled:b,value:p.currentValue,"aria-autocomplete":s.autocomplete,"aria-haspopup":"listbox",autocomplete:"off","aria-expanded":"false"}),"@combobox",s,0,4,{onblur:t.d("blur","handleComboboxBlur",!1),onclick:t.d("click","handleComboboxClick",!1),onfocus:t.d("focus","handleFocus",!1),onkeydown:t.d("keydown","handleComboboxKeyDown",!1),onkeyup:t.d("keyup","handleComboboxKeyUp",!1)});const i=m?"button":null;i?e.be(i,c(h(L),{class:a(["icon-btn","icon-btn--transparent",E])}),"@actionable",s,null,4,{onclick:t.d("click","handleButtonClick",!1)}):e.bf("f_@actionable",s),f?q(e,f,null,null,null,null,t,"3"):O==="large"?k(z,{},e,t,"4"):k(H,{},e,t,"5"),i?e.ee():e.ef()}if(e.ee(),s._hasVisibleOptions()){e.be("div",{role:"listbox",class:"combobox__listbox"},"@listbox",s,null,0);for(const i of X(s._getVisibleOptions())){const{text:n,value:F,class:B,...M}=i;var A=(F||n)===p.currentValue;const g="@options[]",$=`[${g}]`;e.be("div",c(h(M),{role:"option",class:a(["combobox__option",B]),tabindex:"-1","aria-selected":A&&"true"}),g,s,null,4,{pa:{class:1,tabindex:1},onclick:t.d("click","handleSelectOption",!1,[n]),onmousedown:t.d("mousedown","handleSelectOption",!1,[n])}),e.be("span",null,"6"+$,s,null,0),e.t(n,s),e.ee(),e.ee()}e.ee()}e.ee()},{t:r},C);o.Component=U(C,o._);export{o as _};
