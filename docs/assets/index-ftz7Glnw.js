import{t as K,r as T,b as R,e as a,f as U,d as c,p as r,c as N}from"./registry-CtNeIPU8.js";/* empty css                    */import{s as q}from"./index-htxwKVWG.js";import{_ as z}from"./dynamic-tag-HMZVE1pc.js";import{_ as H}from"./index-DN2d98YU.js";import{_ as k}from"./render-tag-mtfFSHEK.js";import{_ as X}from"./index-DfQ7uvCK.js";import{_ as j}from"./of-fallback-C2gEBeKK.js";import{s as G,c as J}from"./index-BGXtVBud.js";import{s as P}from"./index-DXTRRJTV.js";import{c as Q,d as W,h as Y,e as Z}from"./index-CbT4wDAv.js";function ee(l=""){return new RegExp(l.trim().replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i")}class te extends Marko.Component{focus(){this.getEl("combobox").focus()}handleFocus(){this._emitComboboxEvent("focus")}isExpanded(){return this.expander&&this.expander.expanded}isCollapsed(){return this.expander&&!this.expander.expanded}expand(){this.isCollapsed()&&(this.expander.expanded=!0)}collapse(){this.isExpanded()&&(this.expander.expanded=!1)}handleButtonClick(e){this.buttonClicked=!0,this.emit("button-click",{originalEvent:e})}handleActiveDescendantChange(e){if(this.listSelection==="automatic"){const t=this._getVisibleOptions()[e.detail.toIndex];this.getEl("combobox").value=t.text}}setSelectedView(){const e=this._getVisibleOptions().indexOf(this._getSelectedOption());this.activeDescendant.index=e;const t=this.getEls("options")[e];t&&G(t)}handleExpand(){this.state.viewAllOptions?this.setSelectedView():(this.state.viewAllOptions=!0,this.once("update",()=>{this.setSelectedView()})),this.emit("expand")}handleCollapse(){this.activeDescendant.reset(),this.emit("collapse")}handleComboboxClick(e){e.target===document.activeElement&&this.expand()}handleComboboxKeyDown(e){Q(e,()=>{e.preventDefault(),this.expand()}),W(e,()=>{if(this.isExpanded()){const t=this.activeDescendant.index;t!==-1&&this._setSelectedText(this._getVisibleOptions()[t].text),this.input.expanded!==!0&&this.collapse()}}),Y(e,()=>{this.collapse()}),this.emit("keydown",e)}handleComboboxKeyUp(e){Z(e,()=>{this.state.currentValue=this.getEl("combobox").value,this.once("update",()=>{this.expand()}),this.state.viewAllOptions=!1,this._emitComboboxEvent("input-change")})}handleComboboxBlur(){const e=this.optionClicked;e&&this.focus(),!e&&!this.buttonClicked&&this.input.expanded!==!0&&this.collapse(),this.buttonClicked=!1;const t=this.getEl("combobox");this.listSelection==="automatic"&&t.value!==this.state.currentValue&&(this.state.currentValue=t.value),this.lastValue!==this.state.currentValue&&(this.lastValue=this.state.currentValue,this._emitComboboxEvent("change"))}handleSelectOption(e){this._setSelectedText(e),this.emit("option-click",e)}handleFloatingLabelInit(){this._emitComboboxEvent("floating-label-init")}onInput(e){this.autocomplete=e.autocomplete==="list"?"list":"none",this.listSelection=e.listSelection==="manual"?"manual":"automatic",this.lastValue=e.value,this.state={currentValue:this.lastValue,viewAllOptions:this.state&&this.state.viewAllOptions||!0},this.expander&&(this.expandedChange=e.expanded!==this.expanded,this.expandedChange&&(this.expander.expanded=e.expanded)),this.expanded=e.expanded}onMount(){this._setupMakeup()}onUpdate(){this._setupMakeup()}onRender(){typeof window<"u"&&this._cleanupMakeup()}onDestroy(){this._cleanupMakeup()}_setupFloatingLabel(){this._floatingLabel?(this._floatingLabel.refresh(),this.handleFloatingLabelInit()):document.readyState==="complete"?this.el&&(this._floatingLabel=new q(this.el),this.handleFloatingLabelInit()):this.subscribeTo(window).once("load",()=>{this._setupFloatingLabel()})}_setupMakeup(){this._hasVisibleOptions()&&(this.activeDescendant||(this.activeDescendant=J(this.el,this.getEl("combobox"),this.getEl("listbox"),'[role="option"]',{activeDescendantClassName:"combobox__option--active",autoInit:-1,autoReset:-1,axis:"y",autoScroll:!0})),this.expander||(this.expander=new P(this.el,{autoCollapse:!this.expanded,expandOnFocus:!0,collapseOnFocusOut:!this.expanded&&!this.input.button,contentSelector:'[role="listbox"]',hostSelector:'[role="combobox"]',expandedClass:"combobox--expanded",simulateSpacebarClick:!0})),this.expandedChange&&(this.expander.expanded=this.expanded,this.expandedChange=!1)),this.input.floatingLabel&&this._setupFloatingLabel()}_cleanupMakeup(){this.activeDescendant&&(this.activeDescendant.reset(),this.activeDescendant.destroy(),this.activeDescendant=null),this.expander&&(this.expander.destroy(),this.expander=null),this._floatingLabel&&(this._floatingLabel.destroy(),this._floatingLabel=null)}_setSelectedText(e){if(this.state.currentValue!==e){const t=this.getEl("combobox");this.state.currentValue=t.value=e,t.selectionStart=t.selectionEnd=e.length,t.focus(),this._emitComboboxEvent("select")}}_getSelectedOption(){return[...this.input.options??[]].find(e=>e.text===this.state.currentValue)}_getVisibleOptions(){var t;if(this.autocomplete==="none"||this.state.viewAllOptions)return[...this.input.options??[]];const e=ee((t=this.state.currentValue)==null?void 0:t.toString());return[...this.input.options??[]].filter(s=>e.test(s.text||"")||s.sticky)}_hasVisibleOptions(){return!this.input.disabled&&this._getVisibleOptions().length>0}_emitComboboxEvent(e){this.emit(`${e}`,{currentInputValue:this.state.currentValue,selectedOption:this._getSelectedOption(),options:this.input.options})}}const h="qXvwbDvk",o=K(h);T.r(h,()=>o);const C=te;o._=R(function(l,e,t,s,p,se){const{class:v,id:w,button:u,disabled:b,style:y,borderless:V,autocomplete:ie,options:ae,roledescription:O=`Use up and down arrow keys to navigate options.${s.autocomplete==="none"?"":" Options change based on text input"}`,floatingLabel:d,listSelection:le,expanded:ne,fluid:x,chevronSize:S,...E}=l,{class:L,renderBody:f,...I}=u||{};var m=!!u,A=x?"div":"span",_=w||s.getElId("input");e.be(A,{class:a(["combobox",d&&"floating-label",x&&"combobox--fluid",v]),style:U(y)},"0",s,null,1,{onactiveDescendantChange:t.d("activeDescendantChange","handleActiveDescendantChange",!1),"onexpander-expand":t.d("expander-expand","handleExpand",!1),"onexpander-collapse":t.d("expander-collapse","handleCollapse",!1)}),d&&(e.be("label",{for:_,class:a(["floating-label__label",b&&"floating-label__label--disabled"])},"1",s,null,0),e.t(d,s),e.ee()),e.be("span",{class:a(["combobox__control",m&&"combobox__control--actionable",V&&"combobox__control--borderless"])},"2",s,null,1);{e.e("input",c(r(E),{id:_,type:"text",role:"combobox",disabled:b,value:p.currentValue,"aria-autocomplete":s.autocomplete,"aria-roledescription":O,"aria-haspopup":"listbox",autocomplete:"off","aria-expanded":"false"}),"@combobox",s,0,4,{onblur:t.d("blur","handleComboboxBlur",!1),onclick:t.d("click","handleComboboxClick",!1),onfocus:t.d("focus","handleFocus",!1),onkeydown:t.d("keydown","handleComboboxKeyDown",!1),onkeyup:t.d("keyup","handleComboboxKeyUp",!1)});const i=m?"button":null;i?e.be(i,c(r(I),{class:a(["icon-btn","icon-btn--transparent",L])}),"@actionable",s,null,4,{onclick:t.d("click","handleButtonClick",!1)}):e.bf("f_@actionable",s),f?z(e,f,null,null,null,null,t,"3"):S==="large"?k(H,{},e,t,"4"):k(X,{},e,t,"5"),i?e.ee():e.ef()}if(e.ee(),s._hasVisibleOptions()){e.be("div",{role:"listbox",class:"combobox__listbox"},"@listbox",s,null,0);for(const i of j(s._getVisibleOptions())){const{text:n,value:$,class:B,...M}=i;var F=($||n)===p.currentValue;const g="@options[]",D=`[${g}]`;e.be("div",c(r(M),{role:"option",class:a(["combobox__option",B]),tabindex:"-1","aria-selected":F&&"true"}),g,s,null,4,{pa:{class:1,tabindex:1},onclick:t.d("click","handleSelectOption",!1,[n]),onmousedown:t.d("mousedown","handleSelectOption",!1,[n])}),e.be("span",null,"6"+D,s,null,0),e.t(n,s),e.ee(),e.ee()}e.ee()}e.ee()},{t:h},C);o.Component=N(C,o._);export{o as _};
