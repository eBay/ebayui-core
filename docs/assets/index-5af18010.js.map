{"version":3,"file":"index-5af18010.js","sources":["../../src/components/ebay-listbox/component.js","../../src/components/ebay-listbox/index.marko"],"sourcesContent":["import { createLinear } from \"makeup-active-descendant\";\nimport { scroll } from \"../../common/element-scroll\";\nimport * as eventUtils from \"../../common/event-utils\";\n\nexport default class {\n    get isAutoSelection() {\n        return this.input.listSelection === \"auto\";\n    }\n\n    elementScroll() {\n        scroll(this.getEls(\"option\")[this.state.selectedIndex]);\n    }\n\n    handleChange(index, wasClicked) {\n        if (this.state.selectedIndex !== index) {\n            const option = this.input.options[index];\n            if (option.disabled) {\n                return;\n            }\n            this.state.selectedIndex = index;\n            this.once(\"update\", () => {\n                this.emit(\"change\", {\n                    index,\n                    wasClicked,\n                    selected: [option.value],\n                    el: this.getEls(\"option\")[index],\n                });\n            });\n        }\n    }\n\n    handleClick(index) {\n        this.handleChange(index, true);\n    }\n\n    handleMouseDown() {\n        this.wasClicked = true;\n    }\n\n    handleKeyDown(originalEvent) {\n        eventUtils.handleEscapeKeydown(originalEvent, () => {\n            this.emit(\"escape\");\n        });\n\n        eventUtils.handleActionKeydown(originalEvent, () =>\n            this.handleChange(this._activeDescendant.index, false)\n        );\n    }\n\n    handleListboxChange(event) {\n        const selectedIndex = parseInt(event.detail.toIndex, 10);\n        const el = this.getEls(\"option\")[selectedIndex];\n        const wasClicked = this.wasClicked;\n\n        scroll(el);\n\n        if (this.wasClicked) {\n            this.wasClicked = false;\n        }\n        this.handleChange(selectedIndex, wasClicked);\n    }\n\n    onCreate() {\n        this.state = {\n            selectedIndex: -1,\n        };\n    }\n\n    onInput(input) {\n        const { state } = this;\n        input.options = input.options || [];\n        state.selectedIndex = Math.max(\n            -1,\n            input.options.findIndex((option) => option.selected)\n        );\n    }\n\n    onMount() {\n        this._setupMakeup();\n    }\n\n    onUpdate() {\n        this._setupMakeup();\n    }\n\n    onRender() {\n        if (typeof window !== \"undefined\") {\n            this._cleanupMakeup();\n        }\n    }\n\n    onDestroy() {\n        this._cleanupMakeup();\n    }\n\n    _setupMakeup() {\n        const { input, state } = this;\n\n        if (input.options.length && !input.disabled) {\n            const container = this.getEl(\"options\");\n            const optionsContainer = this.getEl(\"options\");\n            this._activeDescendant = createLinear(\n                container,\n                optionsContainer,\n                optionsContainer,\n                \".listbox__option[role=option]\",\n                {\n                    activeDescendantClassName: \"listbox__option--active\",\n                    autoInit: state.selectedIndex,\n                    autoReset: null,\n                    autoScroll: !this.isAutoSelection,\n                }\n            );\n        }\n    }\n\n    _cleanupMakeup() {\n        if (this._activeDescendant) {\n            this._activeDescendant.destroy();\n            this._activeDescendant = undefined;\n        }\n    }\n}\n","import { processHtmlAttributes } from \"../../common/html-attributes\"\n\nstatic var ignoredAttributes = [\n    \"name\",\n    \"grow\",\n    \"borderless\",\n    \"disabled\",\n    \"fluid\",\n    \"invalid\",\n    \"buttonName\",\n    \"options\"\n];\n\nstatic var itemIgnoredAttributes = [\"value\", \"text\", \"selected\", \"disabled\", \"description\"];\n\n$ var selectedOption = input.options[state.selectedIndex];\n$ var selectedText = selectedOption && selectedOption.text;\n<div\n    ...processHtmlAttributes(input, ignoredAttributes)\n    key=\"options\"\n    role=\"listbox\"\n    class=[\"listbox__options\", input.class]\n    tabindex:no-update=(input.tabindex || 0)\n    on-activeDescendantChange(component.isAutoSelection && \"handleListboxChange\")\n    onKeydown(!component.isAutoSelection && \"handleKeyDown\")>\n    <for|option,index| of=(input.options || [])>\n        <div\n            ...processHtmlAttributes(option, itemIgnoredAttributes)\n            key=\"option[]\"\n            class:no-update=[\"listbox__option\", option.class]\n            role=\"option\"\n            tabindex=(option.disabled ? -1 : option.tabindex)\n            aria-disabled=(option.disabled && \"true\")\n            aria-selected=(selectedOption === option && \"true\")\n            onClick(!component.isAutoSelection && \"handleClick\", index)\n            onMousedown(component.isAutoSelection && \"handleMouseDown\")>\n            <span class=\"listbox__value\">${option.text}</span>\n            <if (option.description)>\n                <span class=\"listbox__description\"><${option.description}/></span>\n            </if>\n            <ebay-tick-16-icon/>\n        </div>\n    </for>\n</div>\n<select hidden class=\"listbox__native\" name=input.name>\n    <for|option| of=(input.options || [])>\n        <option\n            value=option.value\n            selected=(option === selectedOption)\n            class=option.class/>\n    </for>\n</select>\n"],"names":["_marko_component","scroll","index","wasClicked","option","originalEvent","eventUtils.handleEscapeKeydown","eventUtils.handleActionKeydown","event","selectedIndex","el","input","state","container","optionsContainer","createLinear","ignoredAttributes","itemIgnoredAttributes","_marko_registerComponent","_marko_componentType","_marko_template","_marko_component2","_","_marko_renderer","out","_componentDef","_component","$global","selectedOption","options","text","be","_marko_merge_attrs","processHtmlAttributes","_marko_class_merge","class","tabindex","pa","d","isAutoSelection","_index","_keyValue","_keyScope","concat","disabled","t","ee","description","_marko_dynamic_tag","_marko_tag","_ebayTick16Icon","name","_keyValue2","_keyScope2","e","value","Component","_marko_defineComponent"],"mappings":"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"}