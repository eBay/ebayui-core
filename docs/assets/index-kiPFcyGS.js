import{t as H,r as K,b as $,d as I,p as v,e as _,c as N}from"./registry-CyswyZw5.js";import{_ as f}from"./dynamic-tag-CXXozR29.js";import{_ as O}from"./index-CqxSgpEp.js";import{_ as R}from"./render-tag-CLyPs9qZ.js";import{_ as w}from"./of-fallback-C2gEBeKK.js";import{s as T,c as U}from"./index-BGXtVBud.js";import{s as V}from"./index-D52eSIAE.js";import{h as G,a as P}from"./index-CbT4wDAv.js";const Y=1300;class j extends Marko.Component{get isAutoSelection(){return this.input.listSelection==="auto"}elementScroll(){T(this.getEls("option")[this.state.selectedIndex])}handleChange(e,s){if(this.state.selectedIndex!==e){const t=[...this.input.options||[]][e];if(t.disabled)return;this.state.selectedIndex=e,this.once("update",()=>{this.emit("change",{index:e,wasClicked:s,selected:[t.value],el:this.getEls("option")[e]})})}}handleClick(e){this.handleChange(e,!0)}handleMouseDown(){this.wasClicked=!0}handleKeyDown(e){G(e,()=>{this.emit("escape")}),P(e,()=>this.handleChange(this._activeDescendant.index,!1));const s=this.getTypeaheadIndex(this.getEl("options").children,e.key,this.input.typeaheadTimeoutLength||Y);if(s!==-1){this._activeDescendant.index=s;const t=this.getEl("options");t.scrollTop=this.getEls("option")[s].offsetTop-t.offsetHeight/2}}handleListboxChange(e){const s=parseInt(e.detail.toIndex,10),t=this.getEls("option")[s],i=this.wasClicked;T(t),this.wasClicked&&(this.wasClicked=!1),this.handleChange(s,i)}onCreate(){this.state={selectedIndex:-1}}onInput(e){const{state:s}=this;e.options=e.options||[],s.selectedIndex=-1;let t=0;for(const i of e.options||[]){if(i.selected){s.selectedIndex=t;break}t++}}onMount(){this._setupMakeup()}onUpdate(){this._setupMakeup()}onRender(){typeof window<"u"&&this._cleanupMakeup()}onDestroy(){this._cleanupMakeup()}_setupMakeup(){var t;const{input:e,state:s}=this;if((t=e.options)!=null&&t.length&&!e.disabled){const i=this.getEl("options"),c=this.getEl("options");this._activeDescendant=U(i,c,c,".listbox__option[role=option]",{activeDescendantClassName:"listbox__option--active",autoInit:s.selectedIndex,autoReset:null,autoScroll:!this.isAutoSelection});const{getIndex:h,destroy:r}=V();this.getTypeaheadIndex=h,this.destroyTypeahead=r}}_cleanupMakeup(){this._activeDescendant&&(this._activeDescendant.reset(),this._activeDescendant.destroy(),this._activeDescendant=void 0)}}const x="EvVdpTum",d=H(x);K.r(x,()=>d);const E=j;d._=$(function(b,e,s,t,i,c){const{name:h,class:r,disabled:q,options:k,tabindex:M=0,typeaheadTimeoutLength:z,...S}=b;e.be("div",I(v(S),{role:"listbox",class:_(["listbox__options",r]),tabindex:M}),"@options",t,null,4,{pa:{tabindex:1},onactiveDescendantChange:s.d("activeDescendantChange",t.isAutoSelection?"handleListboxChange":void 0,!1),onkeydown:s.d("keydown",!t.isAutoSelection&&"handleKeyDown",!1)});{let p=0;for(const l of w(k||[])){let n=p++;const{value:g,class:A,text:u,selected:B,disabled:m,tabindex:D,icon:y,description:o,...L}=l,C="@option[]",a=`[${C}]`;e.be("div",I(v(L),{class:_(["listbox__option",A]),role:"option",tabindex:m?-1:D,"aria-disabled":m&&"true","aria-selected":n===i.selectedIndex&&"true"}),C,t,null,4,{pa:{class:1},onclick:s.d("click",!t.isAutoSelection&&"handleClick",!1,[n]),onmousedown:s.d("mousedown",t.isAutoSelection&&"handleMouseDown",!1)}),y?(e.be("span",{class:"listbox__value"},"0"+a,t,null,1),f(e,y,null,null,null,null,s,"1"+a),u&&(e.be("span",null,"2"+a,t,null,0),e.t(u,t),e.ee()),o&&(e.be("span",null,"3"+a,t,null,0),f(e,o,null,null,null,null,s,"4"+a),e.ee()),e.ee()):(e.be("span",{class:"listbox__value"},"5"+a,t,null,1),e.t(u,t),e.ee(),o&&(e.be("span",{class:"listbox__description"},"6"+a,t,null,1),f(e,o,null,null,null,null,s,"7"+a),e.ee())),R(O,{},e,s,"8"+a),e.ee()}}e.ee(),e.be("select",{hidden:"",class:"listbox__native",name:h},"9",t,null,0);{let p=0;for(const l of w(k||[])){let n=p++;const g=`[${n}]`;e.e("option",{value:l.value,selected:n===i.selectedIndex,class:_(l.class)},"10"+g,t,0,0)}}e.ee()},{t:x},E);d.Component=N(E,d._);export{d as _};
