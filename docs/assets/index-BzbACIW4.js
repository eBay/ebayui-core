import{t as L,r as H,b as K,e as C,p as v,f as u,d as $}from"./registry-B-klnak9.js";import{_}from"./dynamic-tag-DQCvkDdb.js";import{_ as O}from"./index-D8NY5PLw.js";import{_ as V}from"./render-tag-BBOJ9dEX.js";import{s as I,c as N}from"./index-0_D4u4b1.js";import{s as R}from"./index-D52eSIAE.js";import{h as U,a as G}from"./index-blmbJU0z.js";const P=1300;class Y extends Marko.Component{get isAutoSelection(){return this.input.listSelection==="auto"}elementScroll(){I(this.getEls("option")[this.state.selectedIndex])}handleChange(e,s){var t;if(this.state.selectedIndex!==e){const a=(t=this.input.options)==null?void 0:t[e];if(a.disabled)return;this.state.selectedIndex=e,this.once("update",()=>{this.emit("change",{index:e,wasClicked:s,selected:[a.value],el:this.getEls("option")[e]})})}}handleClick(e){this.handleChange(e,!0)}handleMouseDown(){this.wasClicked=!0}handleKeyDown(e){U(e,()=>{this.emit("escape")}),G(e,()=>this.handleChange(this._activeDescendant.index,!1));const s=this.getTypeaheadIndex(this.getEl("options").children,e.key,this.input.typeaheadTimeoutLength||P);if(s!==-1){this._activeDescendant.index=s;const t=this.getEl("options");t.scrollTop=this.getEls("option")[s].offsetTop-t.offsetHeight/2}}handleListboxChange(e){const s=parseInt(e.detail.toIndex,10),t=this.getEls("option")[s],a=this.wasClicked;I(t),this.wasClicked&&(this.wasClicked=!1),this.handleChange(s,a)}onCreate(){this.state={selectedIndex:-1}}onInput(e){const{state:s}=this;e.options=e.options||[],s.selectedIndex=Math.max(-1,e.options.findIndex(t=>t.selected))}onMount(){this._setupMakeup()}onUpdate(){this._setupMakeup()}onRender(){typeof window<"u"&&this._cleanupMakeup()}onDestroy(){this._cleanupMakeup()}_setupMakeup(){const{input:e,state:s}=this;if(e.options.length&&!e.disabled){const t=this.getEl("options"),a=this.getEl("options");this._activeDescendant=N(t,a,a,".listbox__option[role=option]",{activeDescendantClassName:"listbox__option--active",autoInit:s.selectedIndex,autoReset:null,autoScroll:!this.isAutoSelection});const{getIndex:f,destroy:d}=R();this.getTypeaheadIndex=f,this.destroyTypeahead=d}}_cleanupMakeup(){this._activeDescendant&&(this._activeDescendant.reset(),this._activeDescendant.destroy(),this._activeDescendant=void 0)}}const x="EvVdpTum",l=L(x),te=l;H.r(x,()=>l);const w=Y;l._=K(function(b,e,s,t,a,f){const{name:d,class:T,disabled:j,options:c,tabindex:E=0,typeaheadTimeoutLength:q,...M}=b;var k=c[a.selectedIndex];e.be("div",C(v(M),{role:"listbox",class:u(["listbox__options",T]),tabindex:E}),"@options",t,null,4,{pa:{tabindex:1},onactiveDescendantChange:s.d("activeDescendantChange",t.isAutoSelection?"handleListboxChange":void 0,!1),onkeydown:s.d("keydown",!t.isAutoSelection&&"handleKeyDown",!1)});{let h=0;for(const i of c||[]){let r=h++;const{value:z,class:S,text:p,selected:B,disabled:g,tabindex:A,icon:m,description:o,...D}=i,y="@option[]",n=`[${y}]`;e.be("div",C(v(D),{class:u(["listbox__option",S]),role:"option",tabindex:g?-1:A,"aria-disabled":g&&"true","aria-selected":k===i&&"true"}),y,t,null,4,{pa:{class:1},onclick:s.d("click",!t.isAutoSelection&&"handleClick",!1,[r]),onmousedown:s.d("mousedown",t.isAutoSelection&&"handleMouseDown",!1)}),m?(e.be("span",{class:"listbox__value"},"0"+n,t,null,1),_(e,m,null,null,null,null,s,"1"+n),p&&(e.be("span",null,"2"+n,t,null,0),e.t(p,t),e.ee()),o&&(e.be("span",null,"3"+n,t,null,0),_(e,o,null,null,null,null,s,"4"+n),e.ee()),e.ee()):(e.be("span",{class:"listbox__value"},"5"+n,t,null,1),e.t(p,t),e.ee(),o&&(e.be("span",{class:"listbox__description"},"6"+n,t,null,1),_(e,o,null,null,null,null,s,"7"+n),e.ee())),V(O,{},e,s,"8"+n),e.ee()}}e.ee(),e.be("select",{hidden:"",class:"listbox__native",name:d},"9",t,null,0);{let h=0;for(const i of c||[]){const r=`[${h++}]`;e.e("option",{value:i.value,selected:i===k,class:u(i.class)},"10"+r,t,0,0)}}e.ee()},{t:x},w);l.Component=$(w,l._);export{te as C};
